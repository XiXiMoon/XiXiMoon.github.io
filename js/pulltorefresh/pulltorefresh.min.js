!function(){function e(e){this.options=s.extend({},this.constructor.defaultOptions,e),this.init()}var t="object"==typeof self&&self.self==self&&self||"object"==typeof global&&global.global==global&&global||this||{},s={extend:function(e){for(var t=1,s=arguments.length;t<s;t++)for(var n in arguments[t])arguments[t].hasOwnProperty(n)&&(e[n]=arguments[t][n]);return e}};e.VERSION="1.0.0",e.defaultOptions={pullText:"下拉以刷新页面",pullIcon:"&#8675;",relaseText:"释放以刷新页面",refreshText:"刷新",refreshIcon:"&hellip;",threshold:60,max:80,reloadHeight:50};var n="pending",i=null,r=null,o=0,h=0,l=!1,f=e.prototype;f.constructor=e,f.init=function(){this.createRefreshElement(),this.setRefreshStyle(),this.getElement(),this.supportsPassive(),this.bindEvent()},f.createRefreshElement=function(){var e=document.createElement("div");if("body"!==this.options.target){var t=document.getElementById(this.options.target);t.parentNode.insertBefore(e,t)}else document.body.insertBefore(e,document.body.firstChild);e.className="refresh-element",e.id="refresh-element",e.innerHTML='<div class="refresh-box"><div class="refresh-content"><div class="refresh-icon"></div><div class="refresh-text"></div></div></div>'},f.setRefreshStyle=function(){var e=document.createElement("style");e.setAttribute("id","refresh-element-style"),document.head.appendChild(e),e.textContent=".refresh-element {pointer-events: none; font-size: 0.85em; top: 0; height: 0; transition: height 0.3s, min-height 0.3s; text-align: center; width: 100%; overflow: hidden; color: #fff; } .refresh-box {padding: 10px; } .pull {transition: none; } .refresh-text {margin-top: .33em; } .refresh-icon {transition: transform .3s; } .release .refresh-icon {transform: rotate(180deg); }"},f.getElement=function(){this.refreshElem=document.getElementById("refresh-element")},f.supportsPassive=function(){try{var e=Object.defineProperty({},"passive",{get:function(){l=!0}});window.addEventListener("test",null,e)}catch(e){}},f.bindEvent=function(){window.addEventListener("touchstart",this),window.addEventListener("touchmove",this,!!l&&{passive:!1}),window.addEventListener("touchend",this)},f.handleEvent=function(e){var t="on"+e.type;this[t]&&this[t](e)},f.shouldPullToRefresh=function(){return!window.scrollY},f.update=function(){var e=this.refreshElem.querySelector(".refresh-icon"),t=this.refreshElem.querySelector(".refresh-text");e.innerHTML="refreshing"===n?this.options.refreshIcon:this.options.pullIcon,"releasing"===n&&(t.innerHTML=this.options.relaseText),"pulling"!==n&&"pending"!==n||(t.innerHTML=this.options.pullText),"refreshing"===n&&(t.innerHTML=this.options.refreshText)},f.ontouchstart=function(e){this.shouldPullToRefresh()&&(i=e.touches[0].screenY),"pending"===n&&(n="pending",this.update())},f.resistanceFunction=function(e){return Math.min(1,e/2.5)},f.ontouchmove=function(e){r=e.touches[0].screenY,"refreshing"!==n&&("pending"===n&&(this.refreshElem.classList.add("pull"),n="pulling",this.update()),i&&r&&(o=r-i),o>0&&(e.preventDefault(),this.refreshElem.style.minHeight=h+"px",h=this.resistanceFunction(o/this.options.threshold)*Math.min(this.options.max,o),"pulling"===n&&h>this.options.threshold&&(this.refreshElem.classList.add("release"),n="releasing",this.update()),"releasing"===n&&h<this.options.threshold&&(this.refreshElem.classList.remove("release"),n="pulling",this.update())))},f.ontouchend=function(){if("releasing"===n&&h>this.options.threshold)n="refreshing",this.refreshElem.style.minHeight=this.options.reloadHeight+"px",this.refreshElem.classList.add("refresh"),"function"==typeof this.options.onRefresh&&this.options.onRefresh(this.onReset.bind(this));else{if("refreshing"===n)return;this.refreshElem.style.minHeight="0px",n="pending"}this.update(),this.refreshElem.classList.remove("release"),this.refreshElem.classList.remove("pull"),i=r=null,o=h=0},f.onReset=function(){this.refreshElem.classList.remove("refresh"),this.refreshElem.style["min-height"]="0px",n="pending"},"undefined"==typeof exports||exports.nodeType?t.PullToRefresh=e:("undefined"!=typeof module&&!module.nodeType&&module.exports&&(exports=module.exports=e),exports.PullToRefresh=e)}();
